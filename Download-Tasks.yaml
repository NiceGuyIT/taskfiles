---
version: "3"

tasks:

  xh-test:
    desc: Download the xh binary
    vars:
      NAME: xh
      OWNER: ducaale
      COMPRESS_EXT: '{{if eq OS "windows"}}.zip{{else}}.tar.gz{{end}}'
      # Some packages use x86_64 instead of amd64
      ARCH: '{{if eq ARCH "amd64"}}x86_64{{else}}{{ARCH}}{{end}}'
      ASSET_PATTERN: '{{.NAME}}-*-{{.ARCH}}-*-{{OS}}-*{{.COMPRESS_EXT}}'
    preconditions:
      - task: initialize:all
    cmds:
      # vars are not passed to subtasks automatically.
      # https://taskfile.dev/usage/#variables
      # https://github.com/go-task/task/issues/888#issuecomment-1273264393
      - task: github:download
        vars: {
          NAME: '{{.NAME}}',
          OWNER: '{{.OWNER}}',
          ASSET_PATTERN: '{{.ASSET_PATTERN}}',
          COMPRESS_EXT: '{{.COMPRESS_EXT}}',
          ARCH: '{{.ARCH}}',
        }
    status:
      # This only checks if the executable exists. This is to prevent downloading the file twice: once as the system
      # and once as the user.
      # TODO: Check for version numbers to see if it needs to be updated.
      - "'{{.NAME}}' --version"

  cfssl-certinfo:
    desc: Download the cfssl-certinfo binary
    vars:
      NAME: cfssl
      OWNER: cloudflare
    cmds:
      # vars are not passed to subtasks automatically.
      # https://taskfile.dev/usage/#variables
      # https://github.com/go-task/task/issues/888#issuecomment-1273264393
      - task: github:download
        vars: {
          NAME: '{{.NAME}}',
          OWNER: '{{.OWNER}}',
          ASSET_PATTERN: '{{.NAME}}_*_{{OS}}_{{.ARCH}}',
          COMPRESS_EXT: '',
          ARCH: '{{ARCH}}',
        }
    status:
      # This only checks if the executable exists. This is to prevent downloading the file twice: once as the system
      # and once as the user.
      # TODO: Check for version numbers to see if it needs to be updated.
      - "'{{.BIN_DIR}}{{fromSlash \"/\"}}{{.NAME}}' --help"
